{
  "display_name": "Floor Strategy",
  "type": "object",
  "properties": {
    "base_lot_size": {
      "type": "number",
      "title": "Base Lot Size",
      "description": "Initial lot size for the first entry."
    },
    "retracement_lot_mode": {
      "type": "string",
      "title": "Retracement Lot Mode",
      "enum": ["additive", "multiplicative"],
      "description": "How lot size changes on each retracement entry."
    },
    "retracement_lot_amount": {
      "type": "number",
      "title": "Retracement Lot Amount",
      "description": "Amount to add/multiply by on each retracement entry."
    },
    "retracement_pips": {
      "type": "number",
      "title": "Retracement Pips",
      "description": "Adverse movement in pips required to trigger a retracement entry."
    },
    "take_profit_pips": {
      "type": "number",
      "title": "Take Profit Pips",
      "description": "Profit in pips required to close the position."
    },
    "max_layers": {
      "type": "integer",
      "title": "Maximum Layers",
      "description": "Maximum number of layers that can be opened."
    },
    "max_retracements_per_layer": {
      "type": "integer",
      "title": "Max Retracements Per Layer",
      "description": "Max number of retracement entries allowed per layer."
    },
    "volatility_lock_multiplier": {
      "type": "number",
      "title": "Volatility Lock Multiplier",
      "description": "ATR multiplier threshold to trigger volatility lock.",
      "dependsOn": {
        "field": "volatility_check_enabled",
        "values": ["true"]
      }
    },
    "retracement_trigger_progression": {
      "type": "string",
      "title": "Retracement Trigger Progression",
      "enum": ["equal", "additive", "exponential", "inverse"],
      "description": "How retracement triggers progress across layers."
    },
    "retracement_trigger_increment": {
      "type": "number",
      "title": "Retracement Trigger Increment",
      "description": "Used for additive/exponential progression.",
      "dependsOn": {
        "field": "retracement_trigger_progression",
        "values": ["additive", "exponential"]
      }
    },
    "lot_size_progression": {
      "type": "string",
      "title": "Lot Size Progression",
      "enum": ["equal", "additive", "exponential", "inverse"],
      "description": "How base lot size changes across layers."
    },
    "lot_size_increment": {
      "type": "number",
      "title": "Lot Size Increment",
      "description": "Used for additive/exponential progression.",
      "dependsOn": {
        "field": "lot_size_progression",
        "values": ["additive", "exponential"]
      }
    },
    "entry_signal_lookback_candles": {
      "type": "integer",
      "title": "Momentum Lookback Candles",
      "default": 50,
      "description": "Number of candles to analyze for trend direction."
    },
    "entry_signal_candle_granularity_seconds": {
      "type": "integer",
      "title": "Momentum Candle Granularity (seconds)",
      "default": 60,
      "description": "Candle size in seconds used for trend lookback."
    },
    "lot_unit_size": {
      "type": "number",
      "title": "Lot Unit Size",
      "default": 1000,
      "description": "Units per 1 lot."
    },
    "allow_duplicate_units": {
      "type": "boolean",
      "title": "Allow Duplicate Units",
      "default": false,
      "description": "If false, duplicate position sizes are automatically avoided."
    },
    "hedging_enabled": {
      "type": "boolean",
      "title": "Hedging Enabled",
      "default": false,
      "description": "Whether account can hold opposite positions simultaneously."
    },
    "margin_rate": {
      "type": "number",
      "title": "Margin Rate",
      "default": 0.04,
      "description": "Margin requirement rate.",
      "dependsOn": {
        "field": "margin_protection_enabled",
        "values": ["true"]
      }
    },
    "margin_cut_start_ratio": {
      "type": "number",
      "title": "Margin Cut Start Ratio",
      "default": 0.6,
      "description": "Start forced reduction when margin ratio reaches this value.",
      "dependsOn": {
        "field": "margin_protection_enabled",
        "values": ["true"]
      }
    },
    "margin_cut_target_ratio": {
      "type": "number",
      "title": "Margin Cut Target Ratio",
      "default": 0.5,
      "description": "Target ratio after forced reduction.",
      "dependsOn": {
        "field": "margin_protection_enabled",
        "values": ["true"]
      }
    },
    "margin_protection_enabled": {
      "type": "boolean",
      "title": "Margin Protection Enabled",
      "default": true,
      "description": "Enable forced closeout logic based on margin ratio thresholds."
    },
    "volatility_check_enabled": {
      "type": "boolean",
      "title": "Volatility Check Enabled",
      "default": true,
      "description": "Enable ATR-based volatility lock/unlock checks."
    },
    "volatility_unlock_multiplier": {
      "type": "number",
      "title": "Volatility Unlock Multiplier",
      "default": 1.5,
      "description": "ATR multiplier threshold to unlock strategy after lock.",
      "dependsOn": {
        "field": "volatility_check_enabled",
        "values": ["true"]
      }
    },
    "dynamic_parameter_adjustment_enabled": {
      "type": "boolean",
      "title": "Dynamic Parameter Adjustment",
      "default": false,
      "description": "Adjust triggers/targets based on volatility.",
      "dependsOn": {
        "field": "volatility_check_enabled",
        "values": ["true"]
      }
    },
    "atr_period": {
      "type": "integer",
      "title": "ATR Period",
      "default": 14,
      "description": "ATR window for lock detection.",
      "dependsOn": {
        "field": "volatility_check_enabled",
        "values": ["true"],
        "or": [
          {
            "field": "dynamic_parameter_adjustment_enabled",
            "values": ["true"]
          }
        ]
      }
    },
    "atr_baseline_period": {
      "type": "integer",
      "title": "ATR Baseline Period",
      "default": 50,
      "description": "Baseline ATR window used for ATR multiplier comparison.",
      "dependsOn": {
        "field": "volatility_check_enabled",
        "values": ["true"],
        "or": [
          {
            "field": "dynamic_parameter_adjustment_enabled",
            "values": ["true"]
          }
        ]
      }
    },
    "market_condition_override_enabled": {
      "type": "boolean",
      "title": "Market Condition Override",
      "default": true,
      "description": "Enable temporary rule override on bad market conditions."
    },
    "market_condition_spread_limit_pips": {
      "type": "number",
      "title": "Spread Limit (pips)",
      "default": 3.0,
      "description": "Skip new entries when spread exceeds this value.",
      "dependsOn": {
        "field": "market_condition_override_enabled",
        "values": ["true"]
      }
    }
  },
  "required": [
    "base_lot_size",
    "retracement_lot_mode",
    "retracement_lot_amount",
    "retracement_pips",
    "take_profit_pips"
  ]
}
